{% extends "base.html" %}

{% block content %}
<div class="row g-4">
    <div class="col-12">
        <div class="glass-card p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="fw-800 m-0">LIVE ANALYTICS OVERLAY</h5>
                <div class="btn-group">
                    <button class="btn btn-outline-info btn-sm active">Line</button>
                    <button class="btn btn-outline-info btn-sm">Area</button>
                </div>
            </div>
            <div style="height: 400px;">
                <canvas id="dualChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    let mainChart;
    document.addEventListener('DOMContentLoaded', () => {
        mainChart = new Chart(document.getElementById('dualChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Temp', data: [], borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', fill: true, yAxisID: 'y' },
                    { label: 'Hum', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, yAxisID: 'y1' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { position: 'left', grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                    y1: { position: 'right', grid: { display: false }, ticks: { color: '#94a3b8' } }
                },
                plugins: { legend: { labels: { color: '#fff' } } }
            }
        });
    });

    window.onUpdate = function(d) {
        if (d.history.length > 0) {
            mainChart.data.labels = d.history.map(x => x.timestamp);
            mainChart.data.datasets[0].data = d.history.map(x => x.temperature);
            mainChart.data.datasets[1].data = d.history.map(x => x.humidity);
            mainChart.update('none');
        }
    };
</script>
{% endblock %}
